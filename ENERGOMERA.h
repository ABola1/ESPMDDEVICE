#ifndef ENERGOMERA_h
#define ENERGOMERA_h

#include "ESPMDDEVICE.H"

#ifdef ENERGOMERA
/*  #include <Arduino.h>
  #include <IRremoteESP8266.h>
  #include <ESP8266WebServer.h>
  #include <ESP8266HTTPClient.h>
  #include "ESPEEPROM.h"

  extern ESP8266WebServer server; // веб сервер
  extern HTTPClient http; // веб клиент

*/

#include <SoftwareSerial.h>

long Previous = 0; 
int Step = 0;
char x [50];

// открываем сессию
byte CmdOpenSesion[] = {0xaF,0x3F,0x21,0x8D,0x0A};
// читаем тип счетчика
byte CmdReadType[] = {0x06,0x30,0x35,0xb1,0x8d,0x0a};
// снимаем показания
byte CmdEtope[] = {0x81,0xd2,0xb1,0x82,0xc5,0xd4,0x30,0x50,0xc5,0x28,0xa9,0x03,0xb7};
//напряжение на фазах
byte CmdVolta[] = {0x81,0xd2,0xb1,0x82,0x56,0xcf,0xcc,0xd4,0x41,0x28,0xa9,0x03,0x5f};
// мощность
byte CmdPower[] = {0x81,0xd2,0xb1,0x82,0x50,0xcf,0xd7,0xc5,0x50,0x28,0xa9,0x03,0xe4};
// частота  
byte CmdFrequ[] = {0x81,0xd2,0xb1,0x82,0xc6,0xd2,0xc5,0xd1,0x55,0x28,0xa9,0x03,0x5c};
// ток  
byte CmdCurre[] = {0x81,0xd2,0xb1,0x82,0xc3,0x55,0xd2,0xd2,0xc5,0x28,0xa9,0x03,0x5a};
// cos f  
byte CmdCos_f[] = {0x81,0xd2,0xb1,0x82,0xc3,0x55,0xd2,0xd2,0xc5,0x28,0xa9,0x03,0x5a};


#define CYCLE_TIME 15
#define DIR 8 
 
SoftwareSerial UART (10, 11); // RX, TX

struct Energomera{
  String NameParam;
  String StrValue;
  float  FloatValue;
};


String ReadStr;
Energomera Etope;
Energomera Volta;
Energomera Power;
Energomera Curre;
Energomera Frequ;
Energomera Cos_f;

Energomera ValueParser(String inString, String Param);
void PrintVolume(Energomera Buffer);
void EnergomeraRead();
void SendCommand(byte* cmd, int size);
void EmergomeraWrite();
void EnergomeraCycle();

#endif
#endif
